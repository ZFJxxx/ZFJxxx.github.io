---
layout: post
title: Spring源码分析（4）Bean组件
date:   2017-10-04 19:15:10
categories:  Java
tags:  Spring
keywords: Spring
description: 
---
----------------------------------

## Bean组件
bean组件在Spring的Spring.springframework.beans包下，这个包主要解决了3个问题
* Bean的定义
* Bean的创建
* Bean的解析


## Bean的创建
我们主要关心Bean的创建，Spring Bean的创建是典型的工厂模式，它的顶级接口是BeanFactory。

BeanFactory中定义了getBean（）方法，可以从工厂中取到Bean的实例，当然是从接口的实现类中获取。

```
public interface BeanFactory {
	String FACTORY_BEAN_PREFIX = "&";
	
	//getBean方法，返回指定bean的实例，该实例可以是共享的或独立的。
	Object getBean(String name) throws BeansException;
	...
	
	//是否存在具有给定名称的bean
	boolean containsBean(String name);
	
        //这两个接口是判断Bean的作用于，单例还是多例
	boolean isSingleton(String name) throws NoSuchBeanDefinitionException;
	boolean isPrototype(String name) throws NoSuchBeanDefinitionException;
	
        //检查具有给定名称的bean是否与指定的类型匹配。
	boolean isTypeMatch(String name, @Nullable Class<?> typeToMatch) throws NoSuchBeanDefinitionException;

	//确定具有给定名称的bean的类型
	@Nullable
	Class<?> getType(String name) throws NoSuchBeanDefinitionException;
	
	//返回给定bean名称的别名，如果有的话.
	String[] getAliases(String name);

}
```
在BeanFactory里只对IOC容器的基本行为作了定义，根本不关心你的bean是如何定义怎样加载的。正如我们只关心工厂里得到什么的产品对象，至于工厂是怎么生产这些对象的，这个基本的接口不关心。

![enter image description here](http://p7lixluhf.bkt.clouddn.com/beanfactory.png)

可以看到，BeanFactory的三个子类ListableBeanFactory,HierarchicalBeanFactory和AutowireCapableBeanFactory,分三类主要是为了区分Spring内部对象的传递和转化过程，对对象的数据访问做限制。
ListableBeanFactory接口表示Bean是可列表的
HierarchicalBeanFactory表示Bean是有继承关系的，每个Bean可能有父Bean
AutowireCapableBeanFactory接口定义Bean的自动装配规则

而要知道工厂是如何产生对象的，我们需要看具体的IOC容器实现，spring提供了许多IOC容器的实现。比如XmlBeanFactory，ClasspathXmlApplicationContext等。其中XmlBeanFactory就是针对最基本的ioc容器的实现，这个IOC容器可以读取XML文件定义的BeanDefinition（XML文件中对bean的描述）。

而ApplicationContext是Spring提供的一个高级的IoC容器，它除了能够提供IoC容器的基本功能外，还为用户提供了以下的附加服务。

从ApplicationContext接口的实现，我们看出其特点：（ApplicationContext源码见Context组件文章）
*   支持信息源，可以实现国际化。（实现MessageSource接口）
*   访问资源。(实现ResourcePatternResolver接口，这个后面要讲)
*   支持应用事件。(实现ApplicationEventPublisher接口)

## Bean的定义
Bean的定义主要由BeanDefinition描述，Spring成功解析< bean />节点后，在Spring的内部它就被转化成了BeanDefinition对象，后续的操作都围绕BeanDefinition来进行。

![enter image description here](http://p7lixluhf.bkt.clouddn.com/BeanDefinition.png)

