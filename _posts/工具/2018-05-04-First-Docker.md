---
layout: post
title:   理解Docker
date:   2018-05-04 19:15:10
categories:  工具
tags:  Docker
keywords: 
description: 
---

## Docker的理解

Docker的思想来自于集装箱，集装箱解决了什么问题？
因为现在物理服务器是很强大的,我们如果在一台物理服务器上只跑一个服务就浪费了,而同时跑很多服务他们又互相影响,比如说一个服务出了内存泄漏把整个服务器的内存都占满了,其他服务都跟着倒霉。所以要把每个服务都隔离起来,让它们只使用自己那部分有限的cpu,内存和磁盘,以及自己依赖的软件包。这个早先是是用虚拟机来实现隔离的,但是每个虚拟机都要装自己的操作系统核心,这是对资源有点浪费。于是就有了Docker, 一个机器上可以装十几个到几十个docker,他们共享操作系统核心,占用资源少,启动速度块。但又能提供了资源(cpu, 内存,磁盘等）一定程度的隔离。

1.不同的应用程序可能会有不同的应用环境，比如.net开发的网站和Java开发的网站依赖的软件就不一样，如果把他们依赖的软件都安装在一个服务器上就要调试很久，而且很麻烦，还会造成一些冲突。比如IIS和Apache访问端口冲突。这个时候你就要隔离.net开发的网站和Java开发的网站。常规来讲，我们可以在服务器上创建不同的虚拟机在不同的虚拟机上放置不同的应用，但是虚拟机开销比较高。docker可以实现虚拟机隔离应用环境的功能，并且开销比虚拟机小，小就意味着省钱了。

2.你开发软件的时候用的是Ubuntu，但是运维管理的都是centos，运维在把你的软件从开发环境转移到生产环境的时候就会遇到一些Ubuntu转centos的问题，比如：有个特殊版本的数据库，只有Ubuntu支持，centos不支持，在转移的过程当中运维就得想办法解决这样的问题。这时候要是有docker你就可以把开发环境直接封装转移给运维，运维直接部署你给他的docker就可以了。而且部署速度快。

3.在服务器负载方面，如果你单独开一个虚拟机，那么虚拟机会占用空闲内存的，docker部署的话，这些内存就会利用起来。

## 使用Docker的正确姿势
设想一个如下场景：我们需要一个webapp，其功能是用户注册并将注册信息插入到数据库，环境为Ubuntu+Tomcat+Mysql,怎么做？不使用Docker的话，我们通常会这样做，以Ubuntu为操作系统，然后安装Tomcat和MySQL，最后把app部署上就可以了。那么使用Docker会怎么做呢，在这个场景下，可以有两种方式：

1.仍然以Ubuntu为操作系统，然后构建一个安装有MySQL和Tomcat的Docker镜像，并把app部署到其中，最后启动Docker镜像就可以了。看起来好像和不使用Docker基本相同，甚至还要麻烦一些，是这样吗？别着急，继续往下看。

2.第二种方式则体现了Docker的"每个容器只做一件事情"的思想，我们构建两个镜像，一个仅安装Tomcat并部署我们的app，另一个仅安装MySQL，然后启动这两个镜像，得到两个容器，再利用Docker的容器互联技术将二者连接(Docker的容器是通过http连接的)。

## Docker的优点

看完上面的例子，你可能仍然不会觉得Docker有什么好处，其实真正使用了Docker之后，你会觉得简直爱不释手。粗略来说，Docker好处有:

1.保证了线上线下环境的一致性我们在线下的开发环境使用Docker构建好weaapp的镜像后，可以直接在线上使用一个镜像，保证了线上线下环境的一致性，再也不会有在线下开发环境中运行正常，而部署到线上各种错误了。

2.极大的简化了webapp的部署流程在不使用Docker时，我们部署app时，要先搭建好app运行所需环境，这个过程做过的人都知道多么枯燥繁琐，一不小心还出错。而有了Docker，我们只需要直接构建一个我们webapp的镜像然后将其运行即可，无论在多少台服务器中部署，都是如此。再比如，使用Docker之前要搭建一个WordPress对于新手来说是有些困难的，而有了Docker，只需要从DockerHub上pull一个WordPress镜像并启动就可以了，非常非常方便。

3.实现了沙盒机制，提高了安全性由于webapp运行在容器中，与操作系统隔离开了，从而使操作系统基本不可能受到破坏，另外如果webapp因为攻击而瘫痪，并不需要重启服务器，直接重启容器或者再启动一个镜像就可以了。

4.实现了模块化，提高了复用性在二中使用Docker的第二种方式就可以看出，我们将数据库和Tomcat运行在不同的容器中，从某种角度来说，这也降低了模块之间的耦合性，便于拓展。比如我们要把MySQL替换为oracle，只需要再构建一个oracle镜像并启动与Tomcat连接即可，非常方便。对于我们构建的镜像，在其他app中直接拿来用就可以了，不必重复劳动。

5.实现了虚拟化，提高硬件利用率有了Docker，我们可以在一台服务器上运行很多webapp，充分利用闲置资源。这时候，服务器的操作系统就类似于货轮，而一个个Docker容器就相当于货轮上的一个个集装箱。现在大热的云服务市场，不少就用了Docker。举个例子来说，现在我们有一台操作系统为Ubuntu14.04的服务器，我们构建不同版本的ubuntu镜像并启动，并且为不同的用户分配不同的容器。这样，用一台服务器可以虚拟出n个运行着不同操作系统的虚拟服务器。

## Q&A

**Docker的容器是以镜像来创建的，镜像是不是一个类似操作系统的环境?**

是的，你可以将Docker理解为一个轻量化的虚拟机，至于我们经常说的什么Tomcat镜像、MySQL镜像之类的，只是这个轻量化的虚拟机中安装了相应的软件。镜像的名字也就说明了镜像的功能。

**是不是到正式环境上还要安装Docker，然后把应用部署在其中？**

是的，构建Docker镜像、运行Docker容器，都需要安装Docker，但这是一劳永逸的，因为我们使用的是安装了各种各样功能软件的Docker镜像和Docker容器。

**如果是这样，那和我创建一个和生产环境一样的虚拟机来部署应用有什么区别？**

docker相当于轻量级的虚拟机，放弃某些隔离效果换来低代价：同样的物理机，同时运行成千上万个docker都可能，而且启动非常快（虚拟机都有一个“硬件”自检、OS启动的过程；docker基本无这个过程，因为是直接运行在物理机的OS上的）。
安装Docker后，我们可以从DockerHub上获取各种各样的操作系统镜像，这个操作很简单，只需要pull相应的镜像到本地然后运行即可，而安装不同版本的虚拟机有多麻烦？另外DockerHub上有各种各样的优秀镜像，我们直接拿来使用就可以了，不需要自己搭建，应用的部署就像搭积木一样简单。



